menu "Storage / SD card"

config STORAGE_SD_USE_GPIO_CS
    bool "Use direct GPIO for SD card CS instead of CH422G"
    default n
    help
        Enable this option only when the SD card chip-select line is wired
        directly to an ESP32-S3 GPIO. The driver will never touch the CH422G
        expander when this mode is selected.

config STORAGE_SD_GPIO_FALLBACK
    bool "Allow automatic GPIO CS fallback when CH422G probe fails"
    depends on !STORAGE_SD_USE_GPIO_CS
    default y
    help
        When enabled, the storage driver will automatically configure the
        fallback GPIO defined below if the CH422G expander cannot be reached at
        boot. This is useful when the expander is absent, temporarily
        miswired or when the firmware needs to continue operating while the
        bus is repaired.

config STORAGE_SD_GPIO_FALLBACK_AUTO_MOUNT
    bool "Automatically mount the SD card when the fallback CS is engaged"
    depends on STORAGE_SD_GPIO_FALLBACK
    default n
    help
        Enable this option only when the CH422G expander is permanently
        unavailable *and* the CS line has been hard-wired from EXIO to the
        fallback GPIO. Leaving this disabled keeps the firmware from blocking
        inside esp_vfs_fat_sdspi_mount() when no working CS path exists,
        preventing watchdog resets. Once the wiring is in place, enable the
        option to let the firmware attempt the direct-GPIO mount automatically.

config STORAGE_SD_GPIO_CS_NUM
    int "GPIO number for the SD card CS fallback"
    depends on STORAGE_SD_USE_GPIO_CS || STORAGE_SD_GPIO_FALLBACK
    range 0 48
    default 34
    help
        Physical GPIO used to drive the SD card chip-select when bypassing the
        CH422G expander. Waveshare spare headers expose GPIO34 which is safe to
        use without conflicting with the RGB data bus.

endmenu
